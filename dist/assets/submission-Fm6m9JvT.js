import"./script-CVp7Jlnh.js";import{initializeApp as L}from"https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";import{getAuth as A,GoogleAuthProvider as P,onAuthStateChanged as D,signOut as F,signInWithPopup as C}from"https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";const H={apiKey:"AIzaSyBsXDjDbuN5v1Dwx0kBIK6wmvLm8TC1Ei8",authDomain:"journal-399f6.firebaseapp.com",projectId:"journal-399f6",storageBucket:"journal-399f6.firebasestorage.app",messagingSenderId:"401502770070",appId:"1:401502770070:web:9017cb9a6e868951ee43b7"},T=L(H),g=A(T),j=new P,G="https://script.google.com/macros/s/AKfycbwH9ql3P_iGSS0Ni0_Yl5yKDYQbu_PskFHz9FsGLRyuU_JGc3pluGabKaooB07uJzln/exec";function M(){return"SUB-"+Date.now()}D(g,o=>{const l=document.getElementById("login-section"),u=document.getElementById("submission-form-container"),i=document.getElementById("user-panel"),d=document.getElementById("user-avatar"),m=document.getElementById("user-email"),r=document.getElementById("submit-nav-btn");if(o){i&&(i.style.display="flex"),d&&(d.src=o.photoURL||"https://ui-avatars.com/api/?name="+o.email),m&&(m.textContent=o.email),r&&(r.style.display="none"),l.style.display="none",u.style.display="block";const c=document.getElementById("corresp-email");c&&(c.value=o.email)}else i&&(i.style.display="none"),r&&(r.style.display="block"),l.style.display="block",u.style.display="none"});const k=document.getElementById("logout-btn");k&&k.addEventListener("click",()=>{F(g).then(()=>{window.location.reload()})});window.loginWithGoogle=async()=>{try{await C(g,j)}catch{alert("Login failed")}};const b=document.getElementById("agree-checkbox"),v=document.getElementById("login-google-btn");b&&v&&(b.addEventListener("change",()=>{v.disabled=!b.checked}),v.addEventListener("click",()=>{window.loginWithGoogle()}));const x=document.getElementById("manuscript-form");x&&x.addEventListener("submit",async o=>{o.preventDefault(),console.log("Form submission initiated");const l=g.currentUser;if(!l){alert("Please login with Google first to submit your manuscript.");return}const u=document.getElementById("manuscript-title")?.value,i=document.getElementById("manuscript-abstract")?.value,d=document.getElementById("article-type")?.value,m=document.getElementById("subject-area")?.value,r=document.getElementById("file-input"),c=document.getElementById("keywords-hidden")?.value,_=document.querySelectorAll('#step-wrapper-4 input[type="checkbox"]');let E=!0;if(_.forEach(e=>{e.checked||(E=!1)}),!u||!i||!d||!m){alert("Please complete all required fields in Step 1: Manuscript Details.");const e=document.querySelector("#step-wrapper-1 .step-header");e&&e.click();return}if(!r||!r.files.length){alert("Please upload your manuscript file in Step 1.");const e=document.querySelector("#step-wrapper-1 .step-header");e&&e.click();return}if(!c||c.split(",").length<3){alert("Please add at least 3 keywords in Step 2.");const e=document.querySelector("#step-wrapper-2 .step-header");e&&e.click();return}if(!E){alert("Please confirm all declarations in Step 4 before submitting.");return}const a=document.getElementById("submit-btn"),q=a?a.innerHTML:"Submit Manuscript";try{a&&(a.innerHTML='<i class="fas fa-spinner fa-spin"></i> Submitting...',a.disabled=!0);const e=M(),t=new FormData;t.append("submission_id",e),t.append("logged_in_email",l.email),t.append("manuscript_title",u),t.append("abstract",i),t.append("article_type",d),t.append("subject_area",m),t.append("keywords",c);const f=r.files[0];if(!f){alert("Manuscript file missing");return}const w=await new Promise((n,y)=>{const s=new FileReader;s.onload=()=>{const p=s.result;p||y("Failed to read file"),n(p.split(",")[1])},s.onerror=()=>y("File read error"),s.readAsDataURL(f)});t.append("pdf_base64",w),t.append("pdf_filename",f.name),console.log("File name:",f.name),console.log("File base64 length:",w.length);const h=[];h.push({order:1,role:"Corresponding",first_name:document.getElementById("corresp-first-name")?.value||"",last_name:document.getElementById("corresp-last-name")?.value||"",published_name:document.getElementById("corresp-pub-name")?.value||"",email:l.email,orcid:document.getElementById("corresp-orcid")?.value||"",country:document.getElementById("corresp-country")?.value||"",department:document.getElementById("corresp-dept")?.value||"",organization:document.getElementById("corresp-org")?.value||"",position:document.getElementById("corresp-pos")?.value||""}),document.querySelectorAll("#co-authors-accordion-list .author-accordion-item").forEach((n,y)=>{const s=n.querySelector(".co-author-first-name")?.value||"",p=n.querySelector(".co-author-last-name")?.value||"";(s||p)&&h.push({order:y+2,role:"Co-Author",first_name:s,last_name:p,email:n.querySelector(".co-author-email")?.value||"",orcid:n.querySelector(".co-author-orcid")?.value||"",country:n.querySelector(".co-author-country")?.value||"",department:n.querySelector(".co-author-dept")?.value||"",organization:n.querySelector(".co-author-aff")?.value||"",position:""})}),t.append("authors",JSON.stringify(h)),console.log("üì§ Sending submission to Apps Script...");const B=await fetch(G,{method:"POST",body:t});if(!B.ok)throw new Error("Server responded with error");const I=await B.json();if(!I.success)throw new Error(I.error||"Unknown server error");alert("‚úÖ Manuscript submitted successfully!");const S=document.getElementById("submission-form-container");S&&(S.innerHTML=`
            <div style="text-align:center;padding:60px 40px;">
                <div style="width:80px;height:80px;background:#dcfce7;color:#16a34a;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;font-size:40px;">
                    <i class="fas fa-check"></i>
                </div>
                <h2>Submission Successful</h2>
                <p>Your manuscript has been submitted successfully.</p>
                <a href="index.html" class="btn-primary">Return to Home</a>
            </div>
        `),window.scrollTo({top:0,behavior:"smooth"})}catch(e){console.error("Submission Error:",e),alert("‚ùå Submission failed: "+e.message),a&&(a.innerHTML=q,a.disabled=!1)}});
